# 内容增强功能使用指南

## 功能概述

内容增强器（Content Enhancer）是一个强大的模块，可以使用自定义的专业提示词对 RSS 内容进行深度分析和结构化处理。

### 主要特点

✅ 使用自定义系统提示词进行专业分析
✅ 支持复杂的领域知识筛选（如考试备考、行业资讯等）
✅ 输出结构化的 Markdown 内容（表格、分类、评级）
✅ 避免重复 API 调用，提高效率
✅ 支持 OpenAI 和 Claude API

## 快速开始

### 1. 配置 API 密钥

在项目根目录创建 `.env` 文件：

```env
AI_API_KEY=your-api-key-here
AI_API_BASE=https://api.openai.com/v1  # 可选，自定义API地址
AI_MODEL=gpt-3.5-turbo  # 可选，默认使用此模型
```

### 2. 启用内容增强器

编辑 `config/app.yaml`：

```yaml
# 内容增强配置
content_enhancer:
  enabled: true  # 启用内容增强
  provider: "openai"  # 或 "claude"
```

### 3. 编写系统提示词

在项目根目录创建或编辑 `系统提示词.md` 文件，写入你的专业提示词。

示例已包含在项目中（深圳教师招聘考试备考提示词）。

### 4. 运行测试

```bash
# 执行一次测试
python main.py --once
```

## 工作流程

```
RSS 源 → 抓取 → 解析 → 去重 → 过滤未推送 → 内容增强 → 推送
                                        ↑
                                   AI 深度分析
                                   （使用系统提示词）
```

### 核心特性

- **一次性深度分析**：批量处理所有 RSS 条目，一次 API 调用完成
- **可点击链接**：输出的文章标题自动转换为 `[标题](URL)` 格式，用户可直接点击跳转
- **结构化输出**：按重要性分类（★★★★★、★★★★☆、★★★☆☆）
- **专业提示词**：支持复杂的领域知识和评估标准

## 自定义系统提示词

### 提示词结构建议

```markdown
# 角色与目标
定义 AI 的角色和核心目标

# 背景信息
提供必要的领域知识和上下文

# 任务指令
明确说明需要 AI 完成的具体任务

# 分析标准
定义评估维度和标准

# 输出格式
指定输出的格式（Markdown 表格、分类等）

# 约束与规则
设定边界条件和过滤规则
```

### 示例：技术文章筛选

```markdown
# 角色与目标
你是一名技术内容策展人，负责筛选高质量的技术文章。

# 分析标准
- 技术深度 (★★★★★): 是否有深入的技术细节
- 实用价值 (★★★★☆): 是否可以直接应用
- 创新性 (★★★☆☆): 是否包含新颖的观点

# 输出格式
请按以下格式输出：

## 必读文章 (★★★★★)
| 标题 | 权重 | 推荐理由 |
|------|------|----------|
| ... | ★★★★★ | ... |

## 推荐阅读 (★★★★☆)
...
```

## 配置选项详解

### `config/app.yaml` 配置

```yaml
content_enhancer:
  enabled: true              # 是否启用
  provider: "openai"         # API 提供商: openai 或 claude

  # 以下配置可选，优先从 .env 读取
  api_key: ""               # API 密钥（不推荐在此配置）
  api_base: ""              # API 地址（自定义端点）
  model: ""                 # 模型名称
```

### 推荐配置组合

**推荐配置**
```yaml
content_enhancer:
  enabled: true   # 启用内容增强
  provider: "openai"

pushplus:
  message_template:
    max_items: 20  # 一次最多处理20条
    template: "markdown"  # 使用 markdown 格式以支持链接
```

## 推送效果

### 启用内容增强前

```
📰 今日 RSS 推送 (15条)

1. 文章标题A
📝 文章摘要...
🔗 链接

2. 文章标题B
...
```

### 启用内容增强后（带可点击链接）

```
📚 教师招聘考试备考推送

好的，已为您分析完毕。根据深圳教师招聘考试的备考需求，以下是为您筛选出的高价值文章，按重要性排序：

## 一、核心必读 (★★★★★)
| 文章标题 | 权重 | 推荐理由 |
|----------|------|----------|
| [教育强国建设规划发布](http://example.com/article1) | ★★★★★ | 紧扣国家顶层设计，为教育论文提供权威论据 |
| [AI赋能课堂教学创新](http://example.com/article2) | ★★★★★ | 契合教育数字化前沿热点，必考方向 |

## 二、重点阅读 (★★★★☆)
| 文章标题 | 权重 | 推荐理由 |
|----------|------|----------|
| [项目式学习设计案例](http://example.com/article3) | ★★★★☆ | 提供具体教学设计思路，直接用于方案设计题 |
...

💡 点击文章标题即可跳转到原文阅读
```

## 常见问题

### Q: 提示词太长会超过 token 限制吗？
A: 系统会自动限制 RSS 条目的描述长度（默认 300 字符），并使用合理的 max_tokens 设置。

### Q: 推送的链接可以点击吗？
A: 可以！系统会自动将文章标题转换为 Markdown 链接格式 `[标题](URL)`，在 PushPlus 中点击即可跳转到原文。

### Q: 如何查看增强后的内容？
A: 内容会直接推送到 PushPlus，可以在手机或群组中查看 Markdown 格式的消息。

### Q: 支持哪些 API 提供商？
A: 目前支持：
- OpenAI 官方 API
- OpenAI 兼容的自定义 API（如 Azure OpenAI）
- Claude API (Anthropic)

### Q: 成本如何控制？
A:
- 使用 `max_items` 限制每次处理的条目数
- 使用数据库去重避免重复分析
- 选择合适的模型（如 gpt-3.5-turbo 而非 gpt-4）

## 调试技巧

### 查看日志
```bash
tail -f logs/app.log
```

关键日志：
- `内容增强器已启用` - 确认已启用
- `已加载系统提示词` - 确认提示词加载成功
- `开始增强 X 个RSS条目的内容` - 开始处理
- `AI返回内容长度: X 字符` - AI 返回成功

### 测试提示词效果

修改 `debug_rss.py` 添加测试代码：

```python
from src.ai.content_enhancer import ContentEnhancer

config = {
    'enabled': True,
    'provider': 'openai',
}

enhancer = ContentEnhancer(config)
# 测试你的 RSS 条目...
```

## 进阶用法

### 针对不同场景使用多个提示词

1. 创建多个提示词文件：
   - `系统提示词-考试备考.md`
   - `系统提示词-行业资讯.md`

2. 修改 `content_enhancer.py` 中的文件路径：
```python
def _load_system_prompt(self) -> str:
    prompt_file = Path(__file__).parent.parent.parent / '系统提示词-考试备考.md'
    # ...
```

### 结合定时推送

```yaml
scheduler:
  schedule_type: "daily"
  daily_time: "07:30"  # 每天早上 7:30 推送分析结果
```

## 总结

内容增强功能让你的 RSS 推送服务从"简单转发"升级为"智能策展"，特别适合：

- 📚 考试备考资讯筛选
- 🏢 行业情报分析
- 📰 新闻聚合与分类
- 🔬 学术文献筛选
- 💼 专业内容策展

通过自定义系统提示词，你可以将 AI 的强大能力应用到任何垂直领域！

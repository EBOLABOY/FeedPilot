# AI内容筛选配置说明

## 📝 配置步骤

### 0. 安装AI依赖(必需)

如果你要使用OpenAI兼容的API,需要安装openai库:

```bash
pip install openai
```

如果使用Claude API:

```bash
pip install anthropic
```

> 注意: 如果只使用关键词规则评分(`provider: "rule"`),不需要安装这些库。

### 1. 创建环境变量文件

复制 `.env.example` 为 `.env`:

```bash
cp .env.example .env
```

### 2. 填写API配置

编辑 `.env` 文件,填入你的API配置:

```bash
# AI API地址
AI_API_BASE=http://154.19.184.12:3000/v1

# AI API密钥
AI_API_KEY=你的真实API密钥

# AI模型名称
AI_MODEL=你的真实模型名称
```

### 3. 自定义提示词(可选)

编辑 `prompts/scoring_prompt.txt` 文件,自定义AI评分的系统提示词。

默认提示词已经包含了评分标准和格式要求,你可以根据需要修改。

### 4. 配置兴趣领域

编辑 `config/app.yaml` 中的 `ai_filter` 部分:

```yaml
ai_filter:
  enabled: true  # 启用AI筛选
  provider: "openai"  # 使用OpenAI兼容API

  # 用户兴趣(用于AI评分)
  interests:
    - "教育科技"
    - "教学方法"
    - "学校管理"
    - "教育创新"
    - "人工智能教育"

  # 评分阈值
  min_score: 6.0  # 最低6分才推送
  max_items: 15   # 最多保留15条
```

---

## 🎯 工作原理

### AI评分流程

1. **抓取RSS** → 获取所有RSS条目
2. **数据库去重** → 过滤已推送的内容
3. **AI评分** → 对每条内容调用AI API进行评分(0-10分)
4. **筛选过滤** → 只保留评分 ≥ 6.0 的内容
5. **数量限制** → 最多保留15条(按分数从高到低)
6. **推送消息** → 将筛选后的内容推送给用户

### 评分标准

AI会根据以下因素评分:
- 文章与用户兴趣的相关度
- 内容的质量和深度
- 信息的实用性和时效性
- 是否包含广告或推广内容(会减分)

评分范围:
- **9-10分**: 非常相关,强烈推荐
- **7-8分**: 相关性较高,值得阅读
- **5-6分**: 一般相关,可以浏览
- **3-4分**: 相关度较低
- **0-2分**: 不相关或无价值

---

## 🔧 配置选项说明

### provider 选项

- `"rule"`: 使用关键词规则评分(不需要API,离线工作)
- `"openai"`: 使用OpenAI兼容API(支持各种兼容接口)
- `"claude"`: 使用Claude API(需要anthropic库)

### 关键词筛选(rule模式)

如果不想使用AI API,可以将 `provider` 设为 `"rule"`,使用关键词规则评分:

```yaml
ai_filter:
  enabled: true
  provider: "rule"  # 使用规则模式

  keywords_include:  # 包含这些词加分
    - "教育"
    - "教学"
    - "学生"

  keywords_exclude:  # 包含这些词减分
    - "广告"
    - "推广"
```

---

## 🚀 测试AI筛选

### 测试连接

```bash
python main.py --test
```

### 立即执行一次(查看AI评分效果)

```bash
python main.py --once
```

查看日志输出,会显示:
```
开始AI内容筛选和评分...
AI API已配置: http://154.19.184.12:3000/v1 (模型: xxx)
已加载自定义提示词: E:\RSS推送\prompts\scoring_prompt.txt
开始AI评分,共 50 个条目
评分完成,平均分: 7.2
筛选结果: 50 -> 18 条 (阈值: 6.0分)
限制数量: 18 -> 15 条
  [1] 9.2分 - 文章标题1
  [2] 8.8分 - 文章标题2
  [3] 8.5分 - 文章标题3
  ...
```

---

## ⚠️ 注意事项

### API费用

- 每次推送会对所有未推送的内容进行AI评分
- 如果RSS源有50条未推送内容,会调用50次API
- 建议:
  - 控制RSS源的条目数量
  - 或者使用 `rule` 模式(关键词规则,不调用API)
  - 设置合理的 `max_items` 限制

### 速率限制

某些API提供商有速率限制,如果遇到限制:
1. 减少 `max_items` 数量
2. 增加评分超时时间
3. 或者切换到 `rule` 模式

### 备用方案

如果AI API不可用,系统会自动降级到关键词规则评分,确保服务正常运行。

---

## 📊 效果对比

### 启用AI筛选前

- 推送所有未推送的RSS内容(最多20条)
- 可能包含很多无关内容
- 用户需要自己筛选

### 启用AI筛选后

- 只推送高质量、相关度高的内容(最多15条)
- AI自动过滤无关内容
- 按相关度排序,最相关的在前
- 提升阅读效率

---

## 🎉 完成

配置完成后,启动服务:

```bash
python main.py
```

系统会每天早上7:30自动执行,抓取RSS并通过AI筛选后推送高质量内容!
